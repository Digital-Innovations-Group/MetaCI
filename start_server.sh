#!/bin/bash
# export PROJECT=$(pwd)
# export PATH=$PROJECT/node/bin:$PROJECT/node_modules/.bin:$PATH
# # export PATH=${HOME}/.yarn/bin:${HOME}/.config/yarn/global/node_modules/.bin:${PATH}
# # export PATH=${HOME}/.yarn/bin:${PATH}
# # yarn config set prefix ~/.yarn -g
# # Database
# export DATABASE_URL=postgres://metaci@postgres:5432/metaci
# export POSTGRES_USER=metaci
# export POSTGRES_PASSWORD=
# export POSTGRES_DB=metaci

# # General settings
# export BUILD_ENV=development
# export DJANGO_ADMIN_URL=admin
# export DJANGO_SETTINGS_MODULE=config.settings.local

# # Django secret key -- change this to an arbitrary string
# export DJANGO_SECRET_KEY="-b-9mzv9zd8+%ohfaod%ihdr&dwglvn3le7(1k%4q4e0hbm+nk"

# # GitHub Settings
# # Needed to interact with GitHub
# # Option 1: Log in as a GitHub user
# # (Use a Personal Access Token instead of a password if 2FA is enabled)
# export GITHUB_USERNAME=jofsky
# export GITHUB_PASSWORD=a60cfff4371c2c62a4ddb42d733fdf4e20bb15bb
# # Option 2: Log in as a GitHub app
# # GITHUB_APP_ID=
# # GITHUB_APP_KEY=
# # Secret for validating webhooks from GitHub
# export GITHUB_WEBHOOK_SECRET="password"

# # SFDX Settings
# # Needed to create Salesforce scratch orgs
# export SFDX_CLIENT_ID=3MVG9i1HRpGLXp.or6OVlWVWynz5l.LVm9GuZp5eDSX7s0YDDWfCkUMC0LrHzIQa070sI3nGyOUloCFOsocsh
# export SFDX_HUB_KEY='-----BEGIN RSA PRIVATE KEY-----MIIEogIBAAKCAQEAwVAe1YBRi+WpkTp02mOPbgj9NgjpwKQEOJugAqdzBdprBxTsfanQ6jjAJVhWJB+/l6kdFvY2hkDcdwethww0/F7rmD2DegnarJBxgJPRm7MVcNmehlRPWoS0f8O8IT2kKKdsaWLR//o5oNWqLVQ3dmOF34gazXqydbJpzTRsx5I6+Qz2v4fU8l7TeYVQVvSdWJmN3sBZ4bnG3GSu1u6viGQwxulxtJrLnclEgL2Tq0npRn/xfGI4LOlhodQPJQnb6TdXkbF64fSxFP8jrnc+EpqYPeQfFeP5GS7x6CG+kHmJPZdHVLxMp6xabtSIBMQftnu4O0xug7ZeJBziF6JjPQIDAQABAoIBAFHbQmM3pdAuXMIhVa/QLsDyT35dAdZP3XW2+GeHTl5xIZbrFkUT7mHvy/VEVZ2QUAnBU48QjQAGYRSKDMG9uoYPD4X0rkKz/4PI2jcO4NgkWfTiQY0yEDQNM31Sfcw5lNSeKHrrnG7fHx3qu9fb7GxWMi74LBlMVlseREzfYRyUI7ukPZNgdvAGbp3TI0ITAQTbTzKPR4FdyZbmysuDXZuQpbifXxBKPVVYHxbdEYkabK4FKeB1cNRI72T0jt+r6DqFTjfpJHs/FjEoq86HWtHWGh1AYaIi5LBMLQ1tNEcSNvvZW49AsUISqJRFwFvwubBhLh36DaucM4aIWPLQUeUCgYEA37+Qy6o3vvfwj0pJ4Ecqo5FRZkxBbUmVTdr1RVPAFxRchsKzsvx4WKRDkmIlvf/vpaB4cUsYDZVOd1qGXciFQODk+FfLbOCDbcR1qv87YL/tKNRO/soxBt3yS6vyCokn48Ycaqs+tYcHC2O0Vaye/VvwwUSQMLLVdGR84N2hzX8CgYEA3S15dqEiWI8a27EX4AD4q9avNJJCwkO5B9/YBnZBpy1DcFSozP5JfgoH1ilK4tmiXjZO3Y+oTcKRUKOSQPjv8obTt3N3xtdabWMW6sH31kOfiKOmDg2lw/UjYQ+xO5FBE/PiOR4XRbhSe04dJ+U2Gik38f/WtgA9h53YOeAJ5UMCgYA2kFLRN+tsSK6DYwxtAy3kwZVmKwZxjlY4rELP60KW3kJKIsULywHWLAjGc+TcVsOsUlvM1RFCjryZ4puN106XqcBsx4w2OvISHKzNTHzAdU1yfYPeIpSeJhXmWkImS5hMtY1MfgJG5mzTXDcoBXaoNnmZyAyZs6LWRYMmmyXQJQKBgF7x13NSRnEntUrbobkaEaWKehmiM6A6/CHiOFTFzPcb2hhNb0zYV+oQGj8X6Lqq3CV/QKmhsoj23fR00yKq+i3tLNNScPddmMbeQ4cxDtfenYxFW9Iqj58oCzDuUJGWkA4lolYMkcbvEhE2fhOTNH9UdFyhC6WDQuaFnr1xbC4LAoGAbzqfS4vF+kloxneGdWJnAiibvEEUWVmMZ4GMF0a7w0x2l+jwiGT2Kt8PC5VdZvMMktzfTHynq6j6BfnSYCBJFNp1EbwZksGtEnT4ggCdIVNY+N1wVeok1vp/17/R87a1O62MeA5gBeGdpoMof/XrFVUdb/kSXyNt8miUeLOez/M=-----END RSA PRIVATE KEY-----'
# export SFDX_HUB_USERNAME=jkofsky.devhub@salesforce.org

# # # Salesforce Connected App Settings
# # Needed to connect to persistent Salesforce orgs
# export CONNECTED_APP_CLIENT_ID=0WOAx7c0vTMdYGLgD51UUs6_1HwBCrij9TU6lF1ZOS16HyCEwQ8B2w08fKngHdqLHvIplL_x5C6mgx8D0W48m
# export CONNECTED_APP_CLIENT_SECRET=95D3HAmRYgOt0QbnZeQlOzf8JCgn_K3W
# export CONNECTED_APP_CALLBACK_URL=http://localhost:8080/callback

# # AWS Settings
# # Only needed in order to record the results of Robot Framework tests to an Amazon S3 bucket.
# export DJANGO_AWS_ACCESS_KEY_ID=123
# export DJANGO_AWS_SECRET_ACCESS_KEY=123
# export DJANGO_AWS_STORAGE_BUCKET_NAME=123

# # Email settings
# # Only needed if you set up notifications
# export DJANGO_SERVER_EMAIL=

# # Sentry
# # Only needed if you want to send errors to Sentry
# export DJANGO_SENTRY_DSN=

# export SITE_URL="dababy.com"
# export FROM_EMAIL="BOP@dababy.com"
# export REDIS_URL=redis://redis:6379
# - DJANGO_AWS_ACCESS_KEY_ID
# - DJANGO_AWS_SECRET_ACCESS_KEY
# - DJANGO_AWS_STORAGE_BUCKET_NAME
# - DJANGO_SERVER_EMAIL
# - DJANGO_SENTRY_DSN
# echo "HERE";
# $(which yarn);
# echo "HERE";
# $(which python);
# echo "HERE";



/usr/local/bin/python /app/manage.py migrate
if [ "${BUILD_ENV}" = "development" ] ; then
    echo "POPULATING DATABASE WITH TEST DATA"
    /usr/local/bin/python /app/manage.py populate_db;
    /usr/local/bin/python /app/manage.py metaci_scheduled_jobs;
    echo "CREATING ADMIN USER FOR TESTING PURPOSES"
    echo "from django.contrib.auth import get_user_model; User = get_user_model(); User.objects.create_superuser('admin', 'admin@salesforce.com', 'password')" | /usr/local/bin/python manage.py shell
fi
echo "ALL DONE!"
 
/usr/local/bin/python manage.py runserver 0.0.0.0:8000