{% extends 'layout_full.html' %}

{% block layout_parent_link %}<a href="/builds">Builds</a>{% endblock %}

{% block layout_header_text %}Build #{{ build.id }}{% endblock %}

{% block layout_header_details %}
  <ul class="slds-grid slds-page-header__detail-row">
    <li class="slds-page-header__detail-block">
      <p class="slds-text-title slds-truncate slds-m-bottom--xx-small" title="Status">Status</p>
      <p class="slds-text-body--regular slds-truncate" title="{{ build.repo }}">
        <div class="slds-badge {% if build.status == 'failure' or build.status == 'error' %}slds-theme--error{% elif build.status == 'success' %}slds-theme--success{% endif %}">{{ build.status }}</div>
      </p>
    </li>
    <li class="slds-page-header__detail-block">
      <p class="slds-text-title slds-truncate slds-m-bottom--xx-small" title="Plan">Plan</p>
      <p class="slds-text-body--regular slds-truncate" title="{{ build.plan }}">
        <a href="{{ build.plan.get_absolute_url }}">
          {{ build.plan }}
        </a>
      </p>
    </li>
    <li class="slds-page-header__detail-block">
      <p class="slds-text-title slds-truncate slds-m-bottom--xx-small" title="Repo">Repo</p>
      <p class="slds-text-body--regular slds-truncate" title="{{ build.repo }}">
        <a href="{{ build.repo.get_absolute_url }}">
          {{ build.repo }}
        </a>
      </p>
    </li>
    <li class="slds-page-header__detail-block">
      <p class="slds-text-title slds-truncate slds-m-bottom--xx-small" title="Branch">Branch</p>
      <p class="slds-text-body--regular slds-truncate" title="{{ build.branch }}">
        <a href="{{ build.branch.get_absolute_url }}">
          {{ build.branch }}
        </a>
      </p>
    </li>
    <li class="slds-page-header__detail-block">
      <p class="slds-text-title slds-truncate slds-m-bottom--xx-small" title="Commit">Commit</p>
      <p class="slds-text-body--regular slds-truncate" title="{{ build.commit }}">
        <a href="{{ build.repo.get_absolute_url }}/commit/{{ build.commit }}">
          {{ build.commit }}
        </a>
      </p>
    </li>
    <li class="slds-page-header__detail-block">
      <p class="slds-text-title slds-truncate slds-m-bottom--xx-small" title="Org">Org</p>
      <p class="slds-text-body--regular slds-truncate" title="{{ build.plan.org }}">
        <a href="{{ build.repo.get_absolute_url }}/org/{{ build.plan.org }}">
          {{ build.plan.org }}
        </a>
      </p>
    </li>
  </ul>
{% endblock %}

{% block layout_body %}
{% if build.status == 'queued' %}
<div class="slds-box slds-theme--info">
  <h3 class="slds-text-heading--medium">Waiting for a worker</h3>
  <p>The build is currently queued and will start as soon as a worker is available.</p>
  {% if not build.org.scratch %}
  <p>This build is running against a persistent org and may be queued waiting for other builds running against the same org</p>
  {% endif %}
{% else %}
<div class="slds-box">
  <h3 class="slds-text-heading--medium">Build Log</h3>
  {% autoescape off %}
  {{ build.get_log_html }}
  {% endautoescape %}
</div>  

<div class="slds-box">
<h2 class="slds-text-heading--medium">Flows</h2>
{% for flow in flows %}
<div class="slds-box">
  <h3 class="slds-text-heading--medium">
    {{ flow.flow }}
    {% if flow.tests_total %}
    <a href="/tests/{{ flow.build.id }}/{{ flow.flow }}">
      Tests: {{ flow.tests_pass }} Passed, {{ flow.tests_fail }} Failed
    </a>
    {% endif %}
  </h3>

  <div class="slds-box--body">
    {% autoescape off %}
    {{ flow.get_log_html }}
    {% endautoescape %}
  </div>
{% endfor %}
</div>

</div>
{% endif %}
{% endblock %}
